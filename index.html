<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>SIR Simulator - St. Paul's Convent School</title>
  <!-- Import Chart.js from CDN -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- Import Google Font -->
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&display=swap" rel="stylesheet">
  <style>
    /* Global Styles */
    * {
      box-sizing: border-box;
    }
    body {
      margin: 0;
      font-family: 'Roboto', sans-serif;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
      /* Removed background graphic from body */
    }
    /* Container now carries the background graphic */
    .container {
      /* Multiple backgrounds: a nearly opaque white overlay + your background image */
      background: 
        linear-gradient(rgba(255,255,255,0.95), rgba(255,255,255,0.95)),
        url("/Users/chuimingyuen/Library/CloudStorage/OneDrive-St.Paul'sConventSchool(SecondarySection)/Research/Trial 1/WhatsApp Image 2025-02-10 at 3.27.04 PM.jpeg") 
          no-repeat center center;
      background-size: cover;
      max-width: 1200px;  /* Increase or decrease to adjust overall container width */
      width: 100%;
      margin: 0 auto;
      padding: 30px 40px;
      border-radius: 12px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
    }
    /* Header styling */
    .header {
      text-align: center;
      margin-bottom: 30px;
    }
    .header h1 {
      margin: 0;
      font-size: 2em;
      color: #333;
    }
    .header h2 {
      margin: 5px 0 0;
      font-size: 1.2em;
      color: #666;
    }
    /* Two-column layout for parameters and graph */
    .content {
      display: flex;
      gap: 20px;
      align-items: center;  /* Vertically center columns */
    }
    /* Adjust column widths using flex basis:
       - Try changing 40% and 60% to other values for different ratios */
    .parameters {
      flex: 1 1 40%;
    }
    .graph {
      flex: 1 1 60%;
      display: flex;
      align-items: center;   /* Center the canvas vertically */
      justify-content: center; /* Center the canvas horizontally */
    }
    /* Form styling inside parameters panel */
    .form-group {
      margin-bottom: 20px;
      display: flex;
      flex-wrap: wrap;
      align-items: center;
    }
    .form-group label {
      width: 220px;
      font-weight: 500;
      color: #555;
      margin-bottom: 5px;
    }
    .form-group input {
      flex: 1;
      padding: 8px 12px;
      font-size: 16px;
      border: 1px solid #ccc;
      border-radius: 6px;
      transition: border-color 0.3s ease;
    }
    .form-group input:focus {
      outline: none;
      border-color: #74ebd5;
    }
    .form-group input[readonly] {
      background-color: #f0f0f0;
    }
    /* Button styling */
    button {
      display: block;
      width: 200px;
      margin: 30px auto;
      padding: 12px 0;
      font-size: 18px;
      font-weight: 500;
      color: #fff;
      background-color: #74ebd5;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      transition: background-color 0.3s ease, transform 0.2s ease;
    }
    button:hover {
      background-color: #68d3c2;
      transform: translateY(-2px);
    }
    /* Adjust the canvas styling so that its aspect ratio is maintained.
       Here, we remove forced height and let Chart.js maintain the ratio.
       You can also adjust the wrapper (.graph) size if needed. */
    .graph canvas {
      max-width: 100%;
      height: auto;
    }
    /* Responsive adjustments for smaller screens */
    @media (max-width: 700px) {
      .content {
        flex-direction: column;
      }
      .form-group {
        flex-direction: column;
        align-items: flex-start;
      }
      .form-group label {
        width: 100%;
      }
      .form-group input {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- School Header -->
    <div class="header">
      <h1>St. Paul's Convent School</h1>
      <h2>Value Education SIR Simulator</h2>
    </div>
    <!-- Two-column Content -->
    <div class="content">
      <!-- Parameters Panel -->
      <div class="parameters">
        <div class="form-group">
          <label for="population">Total Population (N):</label>
          <input type="number" id="population" value="1000" />
        </div>
        <div class="form-group">
          <label for="initialInfected">Initial Infected (I₀):</label>
          <input type="number" id="initialInfected" value="1" />
        </div>
        <div class="form-group">
          <label for="initialRecovered">Initial Recovered:</label>
          <input type="number" id="initialRecovered" value="0" />
        </div>
        <div class="form-group">
          <label for="susceptible">Initial Susceptible (S₀):</label>
          <input type="number" id="susceptible" value="999" readonly />
        </div>
        <div class="form-group">
          <label for="beta">Infection Rate (β):</label>
          <input type="number" id="beta" value="0.3" step="0.01" />
        </div>
        <div class="form-group">
          <label for="gamma">Recovery Rate (γ):</label>
          <input type="number" id="gamma" value="0.1" step="0.01" />
        </div>
        <div class="form-group">
          <label for="basicReproduction">Basic Reproduction Number (R₀):</label>
          <input type="number" id="basicReproduction" value="3" step="0.1" />
        </div>
        <div class="form-group">
          <label for="days">Simulation Days:</label>
          <input type="number" id="days" value="160" />
        </div>
        <button onclick="runSimulation()">Run Simulation</button>
      </div>
      <!-- Graph Display -->
      <div class="graph">
        <canvas id="sirChart"></canvas>
      </div>
    </div>
  </div>

  <script>
    // Global flag to prevent recursive updates
    let isUpdating = false;
    // Global chart instance and simulation interval
    let chart;
    let simulationInterval;

    // --- Parameter Dependency Functions ---
    function updateSusceptible() {
      const N = parseFloat(document.getElementById("population").value);
      const I = parseFloat(document.getElementById("initialInfected").value);
      const R_init = parseFloat(document.getElementById("initialRecovered").value);
      const S = N - I - R_init;
      document.getElementById("susceptible").value = S;
    }

    function updateBasicReproductionFromBetaGamma() {
      if (isUpdating) return;
      isUpdating = true;
      const beta = parseFloat(document.getElementById("beta").value);
      const gamma = parseFloat(document.getElementById("gamma").value);
      if (gamma !== 0) {
        document.getElementById("basicReproduction").value = (beta / gamma).toFixed(2);
      }
      isUpdating = false;
    }

    function updateBetaFromBasicReproduction() {
      if (isUpdating) return;
      isUpdating = true;
      const reproduction = parseFloat(document.getElementById("basicReproduction").value);
      const gamma = parseFloat(document.getElementById("gamma").value);
      document.getElementById("beta").value = (reproduction * gamma).toFixed(2);
      document.getElementById("basicReproduction").value = reproduction.toFixed(2);
      isUpdating = false;
    }

    document.getElementById("population").addEventListener("input", updateSusceptible);
    document.getElementById("initialInfected").addEventListener("input", updateSusceptible);
    document.getElementById("initialRecovered").addEventListener("input", updateSusceptible);
    document.getElementById("beta").addEventListener("input", updateBasicReproductionFromBetaGamma);
    document.getElementById("gamma").addEventListener("input", updateBasicReproductionFromBetaGamma);
    document.getElementById("basicReproduction").addEventListener("input", updateBetaFromBasicReproduction);

    // --- Simulation & Dynamic Graph Animation ---
    function runSimulation() {
      if (simulationInterval) {
        clearInterval(simulationInterval);
      }
      
      const N = parseFloat(document.getElementById("population").value);
      let I = parseFloat(document.getElementById("initialInfected").value);
      let R = parseFloat(document.getElementById("initialRecovered").value);
      let S = N - I - R;
      const beta = parseFloat(document.getElementById("beta").value);
      const gamma = parseFloat(document.getElementById("gamma").value);
      const totalDays = parseInt(document.getElementById("days").value, 10);
      const dt = 1;
      
      let timeArray = [0];
      let S_array = [S];
      let I_array = [I];
      let R_array = [R];
      
      if (chart) {
        chart.destroy();
      }
      
      const ctx = document.getElementById('sirChart').getContext('2d');
      chart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: timeArray,
          datasets: [
            {
              label: 'Susceptible',
              data: S_array,
              borderColor: '#4285F4',
              fill: false,
              tension: 0.1,
            },
            {
              label: 'Infected',
              data: I_array,
              borderColor: '#EA4335',
              fill: false,
              tension: 0.1,
            },
            {
              label: 'Recovered',
              data: R_array,
              borderColor: '#34A853',
              fill: false,
              tension: 0.1,
            }
          ]
        },
        options: {
          animation: false,
          responsive: true,
          maintainAspectRatio: true, // Ensures the chart maintains its ratio
          plugins: {
            legend: { position: 'top' },
          },
          scales: {
            x: {
              title: { display: true, text: 'Time (days)' },
            },
            y: {
              title: { display: true, text: 'Population' },
            },
          },
        }
      });
      
      let currentDay = 0;
      simulationInterval = setInterval(() => {
        if (currentDay >= totalDays) {
          clearInterval(simulationInterval);
          return;
        }
        
        let dS = -beta * S * I / N;
        let dI = beta * S * I / N - gamma * I;
        let dR = gamma * I;
        
        S += dS * dt;
        I += dI * dt;
        R += dR * dt;
        currentDay += dt;
        
        timeArray.push(currentDay);
        S_array.push(S);
        I_array.push(I);
        R_array.push(R);
        
        chart.data.labels = timeArray;
        chart.data.datasets[0].data = S_array;
        chart.data.datasets[1].data = I_array;
        chart.data.datasets[2].data = R_array;
        chart.update();
      }, 100);
    }
  </script>
</body>
</html>
